qplot(c(1:5), priors$prior.p,
geom="bar", stat = "identity",
binwidth = 1, main="Priors over ratings")
rm(list=ls())
source("analysis/useful_dplyr.R")
library(rjson)
priors = read.csv("models/prior.csv")
speaker = read.csv("models/speaker.csv")
listener = read.csv("models/listener.csv")
speaker.lhd = function(d, alpha, cost = 0) {
exp(alpha*(log(d) - cost)) #Rethink alpha and costs?
}
speaker.prob = function(rating, degree, m, alpha) {
num = speaker.lhd(m[rating, degree], alpha)
norm = 0
for (i in 1:ncol(m)) {
norm = norm + speaker.lhd(m[rating, i], alpha)
}
return(num / norm)
}
nn.post = function(rating, degree, m, alpha, useprior) {
if (useprior) {
prior <- priors[rating, "prior.p"]
} else {
prior = .2
}
speaker.prob(rating, degree, m, alpha) * prior
}
norm.post = function(rating, degree, m, alpha, useprior) {
nn = nn.post(rating, degree, m, alpha, useprior)
norm = 0
for (i in 1:5) {
norm = norm + nn.post(i, degree, m, alpha, useprior)
}
return(nn / norm)
}
run.rsa <- function(d, alpha = 1, useprior = TRUE, usenone = FALSE) {
mat <- d %>%
select(stars, degree, speaker.p) %>%
spread(degree, speaker.p) %>%
mutate(hi = hi / sum(hi),
low = low / sum(low)) %>%
select(hi, low)
if (usenone) {
mat$none <- c(.8, .2, 0, 0, 0)
mat$bad <- c(.25, .5, .25, 0, 0)
}
d$pred <- round(as.numeric(mapply(norm.post,
d$stars,
d$degree,
MoreArgs = list(m = mat,
alpha = alpha,
useprior = useprior))),
digits=4)
return(d)
}
data <- left_join(speaker, listener) %>%
left_join(priors) %>%
rowwise %>%
select(scale, degree, stars, speaker.p, listener.p, prior.p) %>%
mutate(listener.p = ifelse(is.na(listener.p), 0, listener.p)) %>%
group_by(scale)
setwd("~/Desktop/Projects/scalar_implicature/models")
setwd("~/Desktop/Projects/scalar_implicature")
run.rsa <- function(d, alpha = 1, useprior = TRUE, usenone = FALSE) {
mat <- d %>%
select(stars, degree, speaker.p) %>%
spread(degree, speaker.p) %>%
mutate(hi = hi / sum(hi),
low = low / sum(low)) %>%
select(hi, low)
if (usenone) {
mat$none <- c(.8, .2, 0, 0, 0)
mat$bad <- c(.25, .5, .25, 0, 0)
}
d$pred <- round(as.numeric(mapply(norm.post,
d$stars,
d$degree,
MoreArgs = list(m = mat,
alpha = alpha,
useprior = useprior))),
digits=4)
return(d)
}
data <- left_join(speaker, listener) %>%
data <- left_join(speaker, listener) %>%
left_join(priors) %>%
rowwise %>%
select(scale, degree, stars, speaker.p, listener.p, prior.p) %>%
mutate(listener.p = ifelse(is.na(listener.p), 0, listener.p)) %>%
group_by(scale)
data <- left_join(speaker, listener) %>%
left_join(priors)
source("analysis/useful_dplyr.R")
library(rjson)
run.rsa <- function(d, alpha = 1, useprior = TRUE, usenone = FALSE) {
mat <- d %>%
select(stars, degree, speaker.p) %>%
spread(degree, speaker.p) %>%
mutate(hi = hi / sum(hi),
low = low / sum(low)) %>%
select(hi, low)
if (usenone) {
mat$none <- c(.8, .2, 0, 0, 0)
mat$bad <- c(.25, .5, .25, 0, 0)
}
d$pred <- round(as.numeric(mapply(norm.post,
d$stars,
d$degree,
MoreArgs = list(m = mat,
alpha = alpha,
useprior = useprior))),
digits=4)
return(d)
}
data <- left_join(speaker, listener) %>%
left_join(priors) %>%
rowwise %>%
select(scale, degree, stars, speaker.p, listener.p, prior.p) %>%
mutate(listener.p = ifelse(is.na(listener.p), 0, listener.p)) %>%
group_by(scale)
priors = read.csv("models/prior.csv")
speaker = read.csv("models/speaker.csv")
listener = read.csv("models/listener.csv")
data <- left_join(speaker, listener) %>%
left_join(priors) %>%
rowwise %>%
select(scale, degree, stars, speaker.p, listener.p, prior.p) %>%
mutate(listener.p = ifelse(is.na(listener.p), 0, listener.p)) %>%
group_by(scale)
data
md <- data %>%
do(run.rsa(., alpha = 4, useprior = FALSE, usenone = TRUE))
md
qplot(stars, listener.p, col=degree,
data = md) +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
qplot(c(1:5), priors$prior.p,
geom="bar", stat = "identity",
binwidth = 1, main="Priors over ratings")
md <- data %>%
do(run.rsa(., alpha = 4, useprior = FALSE, usenone = TRUE))
qplot(stars, listener.p, col=degree,
data = md) +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
md <- data %>%
do(run.rsa(., alpha = 10, useprior = FALSE, usenone = TRUE))
qplot(stars, listener.p, col=degree,
data = md) +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
md <- data %>%
do(run.rsa(., alpha = 10, useprior = FALSE, usenone = TRUE))
qplot(stars, listener.p, col=degree,
data = md) +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2, main="Model vs Human judgments")
qplot(stars, listener.p, col=degree,
data = md, main="Model vs Human judgments") +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
md <- data %>%
do(run.rsa(., alpha = 10, useprior = FALSE, usenone = TRUE))
qplot(stars, listener.p, col=degree,
data = md, main="Model vs Human judgments") +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
run.rsa <- function(d, alpha = 1, useprior = TRUE, usenone = FALSE) {
mat <- d %>%
select(stars, degree, speaker.p) %>%
spread(degree, speaker.p) %>%
mutate(hi = hi / sum(hi),
low = low / sum(low)) %>%
select(hi, low)
if (usenone) {
mat$none <- c(.8, .2, 0, 0, 0)
mat$bad <- c(.25, .5, .25, 0, 0)
}
d$pred <- round(as.numeric(mapply(norm.post, d$stars, d$degree,
MoreArgs = list(m = mat,
alpha = alpha,
useprior = useprior))),
digits=4)
return(d)
}
data <- left_join(speaker, listener) %>%
left_join(priors) %>%
rowwise %>%
select(scale, degree, stars, speaker.p, listener.p, prior.p) %>%
mutate(listener.p = ifelse(is.na(listener.p), 0, listener.p)) %>%
group_by(scale)
md <- data %>%
do(run.rsa(., alpha = 10, useprior = FALSE, usenone = TRUE))
qplot(stars, listener.p, col=degree,
data = md, main="Model vs Human judgments") +
facet_wrap(~scale) +
geom_line(aes(y = pred), lty = 2)
