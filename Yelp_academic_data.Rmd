---
title: "Yelp_academic_data"
author: "BPeloquin"
date: "May 22, 2015"
output: html_document
---


```{r}
#library(rjson)
library(jsonlite)
source("~/Desktop/Projects/scalar_implicature/analysis/useful_dplyr.R")

# data
j.file <-"~/Desktop/Yelp_academic_data/yelp_min10k.json"
data <- data.frame(fromJSON(sprintf("[%s]", paste(readLines(j.file), collapse=","))))
scalars = c(" good ", " excellent ",
            " like ", " love ",
            " delicious ", " tasty ",
            " some ", " all ",
            " memorable ", " unforgettable ")

# parse text fields for scalar
d = c();
for (w in scalars) {
  for ( t in 1:(nrow(data) - 1) ) {
    ifelse( (grep(w, data[t,]$text) == 1), (d = rbind( d, c(w, data[t,]$stars))), )
  }
}

# get scalar distributions
df = as.data.frame(d)
names(df) = c("scalar", "stars")
df = as.matrix(table(df))

for (r in 1:nrow(df)) {
  df[r,] = (df[r,] / sum(df[r,]))
  #d["cil",] = ci.low(d[r,])
  #d["cih",] = ci.high(d[r,])
}

# format data for RSA
md = as.data.frame(df)
md <- md %>% group_by(scalar, stars)

for (r in 1:nrow(md)) {
  if (md[r,"scalar"] == " all ") {
    md[r,"scale"] = "some_all"
    md[r, "degree"] = "hi"
  } else if (md[r,"scalar"] == " some ") {
    md[r,"scale"] = "some_all"
    md[r, "degree"] = "low"
  } else if (md[r,"scalar"] == " excellent ") {
    md[r,"scale"] = "good_excellent"
    md[r, "degree"] = "hi"
  } else if (md[r,"scalar"] == " good ") {
    md[r,"scale"] = "good_excellent"
    md[r, "degree"] = "low"
  } else if (md[r,"scalar"] == " love ") {
    md[r,"scale"] = "liked_loved"
    md[r, "degree"] = "hi"
  } else if (md[r,"scalar"] == " like ") {
    md[r,"scale"] = "liked_loved"
    md[r, "degree"] = "low"
  } else if (md[r,"scalar"] == " unforgettable ") {
    md[r,"scale"] = "memorable_unforgettable"
    md[r, "degree"] = "hi"
  } else if (md[r,"scalar"] == " memorable ") {
    md[r,"scale"] = "memorable_unforgettable"
    md[r, "degree"] = "low"
  } else if (md[r,"scalar"] == " delicious ") {
    md[r,"scale"] = "palatable_delicious"
    md[r, "degree"] = "hi"
  } else if (md[r,"scalar"] == " tasty ") {
    md[r,"scale"] = "palatable_delicious"
    md[r, "degree"] = "low"
  }
}
md = md[complete.cases(md),]
md = md[, c(4, 5, 2, 3, 1)]
ma <- md %>%
  arrange(scale, stars)
ma
names(ma)[names(ma)=="Freq"] <- "speaker.p"
write.csv(ma, "models/yelp1.csv", row.names=FALSE)

tail(ma, n=25)
View(ma)
d[,"scalar"] = toString(d[,"scalar"])
as.character(d[1,"scalar"])
x <- c("a", "b", "aaaaaaaaaaa")
toString(x)
toString(x, width = 8)

```